<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Evaluating privacy and utility of synthetic data â€“ Generating and evaluating synthetic data in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/LMU_OSC_favicon.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7c905c9fc8f78cd3d6f96538ce4b7aee.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Matomo -->

<script>

    var _paq = window._paq = window._paq || [];

    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */

    _paq.push(['trackPageView']);

    _paq.push(['enableLinkTracking']);

    (function() {

        var u = "https://www.analytics.osc.lmu.de/";

        _paq.push(['setTrackerUrl', u + 'matomo.php']);

        _paq.push(['setSiteId', '12']);

        var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];

        g.async = true; g.src = u + 'matomo.js'; s.parentNode.insertBefore(g, s);

    })();

</script>

<!-- End Matomo Code -->

  

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="https://raw.githubusercontent.com/lmu-osc/branding-resources/refs/heads/main/lmu-osc-styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Generating and evaluating synthetic data in R</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">Generating and evaluating synthetic data in <code>R</code></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/lmu-osc/synthetic-data-tutorial">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/lmu-osc/synthetic-data-tutorial/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
    <a href="https://www.osc.uni-muenchen.de/index.html" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-heart"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Evaluating privacy and utility of synthetic data</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sdc/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical disclosure control</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../synthetic/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synthetic data: The general idea</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../generation/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generating synthetic data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../evaluation/" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Evaluating synthetic data quality</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="..\assets/LMU_OSC_logo.svg" class="img-fluid" width="175"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#synthetic-data-utility" id="toc-synthetic-data-utility" class="nav-link active" data-scroll-target="#synthetic-data-utility">Synthetic data utility</a></li>
  <li><a href="#fit-for-purpose-measures" id="toc-fit-for-purpose-measures" class="nav-link" data-scroll-target="#fit-for-purpose-measures">Fit-for-purpose measures</a></li>
  <li><a href="#further-synthesis-improvements" id="toc-further-synthesis-improvements" class="nav-link" data-scroll-target="#further-synthesis-improvements">Further synthesis improvements</a></li>
  <li><a href="#global-utility-measures" id="toc-global-utility-measures" class="nav-link" data-scroll-target="#global-utility-measures">Global utility measures</a>
  <ul class="collapse">
  <li><a href="#divergence-estimation-through-density-ratio-estimation" id="toc-divergence-estimation-through-density-ratio-estimation" class="nav-link" data-scroll-target="#divergence-estimation-through-density-ratio-estimation">Divergence estimation through density ratio estimation</a></li>
  </ul></li>
  <li><a href="#outcome-specific-utility" id="toc-outcome-specific-utility" class="nav-link" data-scroll-target="#outcome-specific-utility">Outcome-specific utility</a></li>
  <li><a href="#statistical-disclosure-control" id="toc-statistical-disclosure-control" class="nav-link" data-scroll-target="#statistical-disclosure-control">Statistical disclosure control</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/lmu-osc/synthetic-data-tutorial/edit/main/evaluation/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/lmu-osc/synthetic-data-tutorial/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Evaluating privacy and utility of synthetic data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled" title="Code so far">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code so far
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section builds on the <a href="../generation/">previous section</a>, and assumes you have completed all exercises. You will need the following output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">url</span>(<span class="st">"https://github.com/lmu-osc/synthetic-data-tutorial/raw/refs/heads/main/data/boys.RDS"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(synthpop)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(densityratio)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>syn_param <span class="ot">&lt;-</span> <span class="fu">syn</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"parametric"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>method <span class="ot">&lt;-</span> syn_param<span class="sc">$</span>method</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>method[<span class="st">"bmi"</span>] <span class="ot">&lt;-</span> <span class="st">"~I(wgt/(hgt/100)^2)"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>syn_passive <span class="ot">&lt;-</span> <span class="fu">syn</span>(</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> method,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">print =</span> <span class="cn">FALSE</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="synthetic-data-utility" class="level1">
<h1>Synthetic data utility</h1>
<hr>
<p>The quality of synthetic data can be evaluated on multiple levels and in different ways. Often, three types of utility measures are distinguished <span class="citation" data-cites="drechsler_30years_2024">(<a href="#ref-drechsler_30years_2024" role="doc-biblioref">Drechsler and Haensch 2024</a>)</span>:</p>
<ol type="1">
<li><em>Fit-for-purpose measures</em> are typically the first step in evaluating synthetic data utility, and evaluates for example whether variable types are consistent with the observed data and whether constraints in the observed data are reproduced in the synthetic data (i.e., non-negative quantities, deterministic relationships like between <code>hgt</code>, <code>wgt</code> and <code>bmi</code>).</li>
<li><em>Global utility measures</em> compare the observed and synthetic data on the level of the entire (multivariate) distribution. In theory, if the observed and synthetic data are drawn from the same distribution, any analysis performed on the synthetic data should yield results that are close to results obtained from the observed data. However, in practice, such global measures can be too broad, and high global utility does not guarantee that results of specific analyses are similar between observed and synthetic data.</li>
<li><em>Outcome-specific utility measures</em> evaluate utility for a specific analysis. In the context of synthetic data for open science, it would be helpful if results from the observed data can be approximated closely in the synthetic data. Note that specific utility really focuses on a set of analyses, but does not need to transfer to different analyses.</li>
</ol>
<p>In isolation, none of these measures typically provide an all-encompassing qualification of utility, also because utility is use-case dependent. In many instances, the synthetic data modeller does not know what the data will be used for. In these settings, outcome-specific utility measures are only of limited help, and global utility measures might provide the broadest picture of the utility of the synthetic data. However, for open science purposes, one could argue that fit-for-purpose measures and outcome-specific utility measures are most important, because in many instances, a data user would want to reproduce the original analyses. Note, however, that even if outcome-specific utility is low, ultimately, the synthetic data can be very useful still, as it at least allows to run the original analysis code, and evaluate whether it contains any errors. In what follows, we briefly discuss all three types of measures.</p>
<hr>
</section>
<section id="fit-for-purpose-measures" class="level1">
<h1>Fit-for-purpose measures</h1>
<hr>
<p>We already evaluated whether the synthetic data looked plausible, by checking that the variables were strictly positive, and that the relationship for <code>bmi</code> was preserved in the synthetic data. We now go one step further, and compare the marginal distributions of the variables in the synthetic data with the corresponding variables in the observed data.</p>
<hr>
<p><strong>1. Compare descriptive statistics from <code>syn_passive</code> with descriptive statistics we calculated in the observed data. What do you see?</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Descriptive statistics of the observed and synthetic data</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(syn_passive<span class="sc">$</span>syn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>      age              hgt             wgt              bmi       
 Min.   : 0.035   Min.   : 50.0   Min.   :  3.14   Min.   :11.77  
 1st Qu.: 1.581   1st Qu.: 84.0   1st Qu.: 11.70   1st Qu.:15.90  
 Median :10.505   Median :145.8   Median : 34.65   Median :17.46  
 Mean   : 9.159   Mean   :131.1   Mean   : 37.15   Mean   :18.04  
 3rd Qu.:15.267   3rd Qu.:175.0   3rd Qu.: 59.58   3rd Qu.:19.49  
 Max.   :21.177   Max.   :198.0   Max.   :117.40   Max.   :31.74  
       hc        gen      phb            tv            reg     
 Min.   :33.70   G1:287   P1:316   Min.   : 1.000   north: 81  
 1st Qu.:48.50   G2:162   P2:122   1st Qu.: 2.000   east :161  
 Median :53.20   G3: 55   P3: 54   Median : 3.000   west :240  
 Mean   :51.64   G4: 87   P4: 63   Mean   : 8.309   south:193  
 3rd Qu.:56.00   G5:157   P5:102   3rd Qu.:15.000   city : 73  
 Max.   :65.00            P6: 91   Max.   :25.000              </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      age              hgt             wgt              bmi        
 Min.   : 0.038   Min.   : 54.0   Min.   : 4.120   Min.   : 4.602  
 1st Qu.: 1.595   1st Qu.: 75.8   1st Qu.: 8.648   1st Qu.:14.983  
 Median :10.499   Median :146.9   Median :44.700   Median :18.927  
 Mean   : 9.063   Mean   :128.9   Mean   :37.860   Mean   :18.598  
 3rd Qu.:15.249   3rd Qu.:177.9   3rd Qu.:64.000   3rd Qu.:22.199  
 Max.   :20.813   Max.   :193.5   Max.   :88.100   Max.   :44.669  
       hc        gen      phb            tv           reg     
 Min.   :34.90   G1:221   P1:223   Min.   : 1.00   north:108  
 1st Qu.:44.50   G2:159   P2:134   1st Qu.: 2.00   east :144  
 Median :54.85   G3: 92   P3: 81   Median : 3.00   west :213  
 Mean   :50.91   G4:115   P4: 87   Mean   : 8.66   south:176  
 3rd Qu.:56.90   G5:161   P5:142   3rd Qu.:15.00   city :107  
 Max.   :60.00            P6: 81   Max.   :25.00              </code></pre>
</div>
</div>
<p>All descriptives are quite close, although the categorical variables seem to have somewhat different counts per category in the synthetic data. Perhaps we can finetune our model here still.</p>
</div>
</div>
</div>
<hr>
<p><strong>2. Use <code>compare()</code> from the <code>synthpop</code> package to compare the distributions of the observed data with the <code>syn_passive</code> data, set the parameters <code>utility.stats = NULL</code> and <code>utility.for.plot = NULL</code>. What do you see?</strong></p>
<p><em>Note: We set <code>utility.stats = NULL</code> and <code>utiltiy.for.plot = NULL</code> because here we just focus on the visualiztions. We will use different utility statistics later on.</em></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Compare synthetic and observed data</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    syn_passive, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    data, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">utility.stats =</span> <span class="cn">NULL</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">utility.for.plot =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">print.flag =</span> <span class="cn">FALSE</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Comparing percentages observed with synthetic</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/compare-synds-output-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Press return for next variable(s): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/compare-synds-output-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Press return for next variable(s): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/compare-synds-output-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Marginally, we see that the distributions of the variables are quite okay, but some improvements are possible. For example, for <code>wgt</code>, quite some values between 10 and 50 kilograms are observed in the real data, but barely any synthetic values fall in this range. Also, <code>bmi</code> values seem to be over or under estimated. In fact, <code>bmi</code> values below 10 are very problematic and highly unlikely. All in all, this suggests that the relationship between <code>hgt</code> and <code>wgt</code> has not been modelled appropriately.</p>
</div>
</div>
</div>
<p>We further explore the utility of the synthetic data on a multivariate level. Since visual inspection is typically most insightful, we use the <code>plot()</code> function.</p>
<hr>
<p><strong>3. Plot the variables <code>age</code>, <code>hgt</code>, <code>wgt</code>, <code>bmi</code>, <code>hc</code> and <code>tv</code> against each other, by calling <code>plot()</code> on the subset of the data containing these variables. Do the same for the synthetic data.</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Plot observed and synthetic data</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    data[,<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"wgt"</span>, <span class="st">"bmi"</span>, <span class="st">"hc"</span>, <span class="st">"tv"</span>)],</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Observed data"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    syn_passive<span class="sc">$</span>syn[,<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"wgt"</span>, <span class="st">"bmi"</span>, <span class="st">"hc"</span>, <span class="st">"tv"</span>)],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Synthetic data"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-bivariate-output-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-bivariate-output-2.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>We see that the distributions of the synthetic data are much more noisy than the distributions of the observed data. That is, even though linear relationships between variables are more or less preserved, the non-linear relationships are not captured very well, leading to more noisy synthetic data.</p>
</div>
</div>
</div>
<p>Now that we investigate fit-for-purpose utility, we must decide whether the synthetic data is of sufficient quality. By now, you probably suspect that this depends on the use-case at hand. We decide that we attempt to further improve the utility of the synthetic data.</p>
</section>
<section id="further-synthesis-improvements" class="level1">
<h1>Further synthesis improvements</h1>
<p>To improve the utility of the synthetic data, we use regression trees for the continuous variables (the <code>"cart"</code> model in <code>synthpop</code>), which is a non-parametric method that is better able to capture non-linear relationships between variables. In short, <code>cart</code> repetitively splits the predictor space according to which predictor is best able to predict the outcome, leading to so-called <em>leaves</em> in which subsets of the outcome with relatively similar values are collected <span class="citation" data-cites="islr">(see, e.g., Section 8.1.1 in <a href="#ref-islr" role="doc-biblioref">James et al. 2023</a>)</span>. Synthetic data is then obtained by splitting the predictors of the synthetic cases according to the learned splits, after which values are sampled from the leaves. Because this approach recycles observed data, we add some smoothing, so that the observed values are not exactly reproduced in the synthetic data. This smoothing is often essential from a privacy-perspective, because it makes sure that synthetic values are not exactly equal to the observed data values.</p>
<hr>
<p><strong>4. Adjust the previously created method vector by replacing every instance of <code>"normrank"</code> with <code>"cart"</code>, and call <code>syn()</code> with this new method vector and <code>smoothing = "spline"</code>.</strong></p>
<p><em>You may again use <code>seed = 123</code> to replicate our results.</em></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Synthetic data with <code>cart</code></summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>method[method <span class="sc">==</span> <span class="st">"normrank"</span>] <span class="ot">&lt;-</span> <span class="st">"cart"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>syn_cart <span class="ot">&lt;-</span> synthpop<span class="sc">::</span><span class="fu">syn</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> method,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoothing =</span> <span class="st">"spline"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">print.flag =</span> <span class="cn">FALSE</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Variable(s) bmi with passive synthesis: relationship does not hold in data.
Total of 723 case(s) where predictors do not give value present in data.
You might want to recompute the variable(s) in the original data.</code></pre>
</div>
</div>
<p>We once more get the message that the relationship for <code>bmi</code> does not hold in the observed data, but we ignore this again.</p>
<hr>
<p><strong>5. Check whether the synthetic data looks okay using the <code>compare()</code> function that we used previously.</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Compare synthetic and observed data</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    syn_cart, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    data, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">utility.stats =</span> <span class="cn">NULL</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">utility.for.plot =</span> <span class="cn">NULL</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">print.flag =</span> <span class="cn">FALSE</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Comparing percentages observed with synthetic</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/compare-synds-cart-output-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Press return for next variable(s): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/compare-synds-cart-output-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Press return for next variable(s): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/compare-synds-cart-output-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Marginally, we see that the distributions of the variables are better already than using <code>normrank</code>. This looks promising.</p>
</div>
</div>
</div>
<hr>
<p><strong>6. Plot the variables <code>age</code>, <code>hgt</code>, <code>wgt</code>, <code>bmi</code>, <code>hc</code> and <code>tv</code> against each other, by calling <code>plot()</code> on <code>syn_cart$syn</code>.</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Plot synthetic data with <code>cart</code></summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    data[,<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"wgt"</span>, <span class="st">"bmi"</span>, <span class="st">"hc"</span>, <span class="st">"tv"</span>)],</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Observed data"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    syn_cart<span class="sc">$</span>syn[,<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"wgt"</span>, <span class="st">"bmi"</span>, <span class="st">"hc"</span>, <span class="st">"tv"</span>)],</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Synthetic data"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-bivariate-cart-output-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-bivariate-cart-output-2.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Using <code>cart</code>, the synthetic data looks substantially more like the observed data than the previously created synthetic data, because it is better able to reproduce non-linear relationships between variables.</p>
</div>
</div>
</div>
<p>We now have two synthetic data sets that seem to have different levels of utility. We will further explore this using global and outcome-specific utility measures.</p>
<hr>
</section>
<section id="global-utility-measures" class="level1">
<h1>Global utility measures</h1>
<hr>
<p>We evaluate global utility by comparing the distributions of the synthetic data sets with the distribution of the observed data. This is often done using one of two ways.</p>
<ol type="1">
<li>The first is to compare the two distributions using some discrepancy measure. The smaller the discrepancy is, the more the synthetic data looks like the observed data.</li>
<li>Another method is to train a classification model to distinguish between the observed and synthetic data, a method commonly called the propensity mean squared error <span class="citation" data-cites="snoke_utility_2018">(<span class="math inline">\(pMSE\)</span>; for more information about this method, see <a href="#ref-snoke_utility_2018" role="doc-biblioref">Snoke et al. 2018</a>)</span>. The easier it is for the classifier to distinguish between the observed and synthetic data, the lower the global utility, because this implies that the observed and synthetic data are different on some aspects.</li>
</ol>
<p>We discuss the former approach, as it performed better for evaluating synthetic data utility according to <span class="citation" data-cites="volker_density_2024">Volker, Wolf, and Kesteren (<a href="#ref-volker_density_2024" role="doc-biblioref">2024</a>)</span>.</p>
<hr>
<section id="divergence-estimation-through-density-ratio-estimation" class="level2">
<h2 class="anchored" data-anchor-id="divergence-estimation-through-density-ratio-estimation">Divergence estimation through density ratio estimation</h2>
<p>One way to evaluate global utility is by comparing the distributions of the observed and synthetic data directly. This can be done using density ratio estimation, which, like the name suggests, attempts to estimate the ratio of the densities of two groups of samples (note that we mean the same thing with distribution and density, although some nuances exist). That is, we attempt to estimate <span class="math display">\[
r(X) = \frac{f_\text{obs}(X)}{f_\text{syn}(X)}.
\]</span> This can be done by estimating the distributions of <span class="math inline">\(f_\text{obs}(X)\)</span> and <span class="math inline">\(f_\text{syn}(X)\)</span>, but estimating <span class="math inline">\(r(X)\)</span> directly typically yields better results. The <code>R</code>-package <code>densityratio</code> has been developed for this purpose <span class="citation" data-cites="densityratio">(<a href="#ref-densityratio" role="doc-biblioref">Volker, Gonzalez Poses, and van Kesteren 2024</a>)</span>. Based on the density ratio, we can estimate various divergence measures between the two data sets, which is an in-built functionality.</p>
<hr>
<p><strong>7. Compare the observed and synthetic data with the <code>ulsif()</code> function from the <code>densityratio</code> package. Do this for both synthetic data sets.</strong></p>
<p><em>Note: Set <code>numerator_data = data</code> and <code>denominator_data = syn_passive$syn</code> and <code>denominator_data = syn_cart$syn</code>.</em></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Estimate density ratio with <code>ulsif()</code></summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r_passive <span class="ot">&lt;-</span> <span class="fu">ulsif</span>(data, syn_passive<span class="sc">$</span>syn)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>r_cart <span class="ot">&lt;-</span> <span class="fu">ulsif</span>(data, syn_cart<span class="sc">$</span>syn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>ulsif()</code> function performs cross-validation to find the optimal model to estimate the density ratio, so that typically no model specification on behalf of the user is required.</p>
<hr>
<p><strong>8. Call <code>plot()</code> on the estimated model objects. This displays the distributions of the estimated density ratio values for the observed and synthetic data.</strong></p>
<p><em>Hint:</em> The more these distributions overlap, the higher the similarity between the observed and synthetic data.</p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Plot density ratio values</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r_passive)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r_cart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Negative estimated density ratios for 108 observation(s) converted to
0.01 before applying logarithmic transformation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-dr-dist-output-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-dr-dist-output-2.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>You will see that the density ratio values of the <code>syn_passive</code> data overlap much less with the density ratio values of the observed data than the density ratio values of the <code>syn_cart</code> values, indicating higher utility.</p>
</div>
</div>
</div>
<hr>
<p><strong>9. Call <code>summary()</code> on the density ratio objects to obtain the estimated Pearson divergence between the observed and synthetic data sets.</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Summary of the density ratio objects</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(r_passive)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(r_cart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ulsif(df_numerator = data, df_denominator = syn_passive$syn)

Kernel Information:
  Kernel type: Gaussian with L2 norm distances
  Number of kernels: 200

Optimal sigma: 1.268872
Optimal lambda: 0.0379269
Optimal kernel weights: num [1:201] 0.00433 0.01786 0.09393 0.08489 0.868 ...
 
Pearson divergence between P(nu) and P(de): 0.9016
For a two-sample homogeneity test, use 'summary(x, test = TRUE)'.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ulsif(df_numerator = data, df_denominator = syn_cart$syn)

Kernel Information:
  Kernel type: Gaussian with L2 norm distances
  Number of kernels: 200

Optimal sigma: 4.554126
Optimal lambda: 0.6951928
Optimal kernel weights: num [1:201] 0.02124 0.011 0.00753 0.00421 0.00335 ...
 
Pearson divergence between P(nu) and P(de): 0.007073
For a two-sample homogeneity test, use 'summary(x, test = TRUE)'.</code></pre>
</div>
</div>
<p>The Pearson divergence of the <code>syn_cart</code> data is substantially smaller than the Pearson divergence of the <code>syn_passive</code> data, indicating higher global utility of the former.</p>
</div>
</div>
</div>
<p>Finally, we can plot the estimated density ratios against the variables in the synthetic data, to see where the synthetic data does not fit the observed data.</p>
<hr>
<p><strong>10. Use <code>plot_bivariate()</code> on the fitted density ratio models, and set <code>grid = TRUE</code> and <code>samples = "denominator"</code> to only display the synthetic data points.</strong></p>
<p><em>Hint:</em> Very dark blue values indicate that synthetic data points in those regions are rather scarce in the observed data, whereas dark red values indicate that in some regions, the synthetic data is underrepresented.</p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Plot density ratio values against the variables</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bivariate</span>(r_passive, <span class="at">grid =</span> <span class="cn">TRUE</span>, <span class="at">samples =</span> <span class="st">"denominator"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bivariate</span>(r_cart, <span class="at">grid =</span> <span class="cn">TRUE</span>, <span class="at">samples =</span> <span class="st">"denominator"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Negative estimated density ratios for 108 observation(s) converted to
0.01 before applying logarithmic transformation</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-bivariate-dr-output-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/plot-bivariate-dr-output-2.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The visualizations again show that the <code>normrank</code> method yielded synthetic data in regions where it was not so much expected, and that the <code>cart</code> method produces synthetic data with higher utility.</p>
</div>
</div>
</div>
</section>
</section>
<section id="outcome-specific-utility" class="level1">
<h1>Outcome-specific utility</h1>
<p>For outcome-specific utility, we of course need at least one analysis that we expect data users will be interested in. For now, we assume that the data users will be interested in predicting head circumference (<code>hc</code>), based on <code>age</code>, height (<code>hgt</code>), weight (<code>wgt</code>) and region (<code>reg</code>), where we include a non-linear effect for <code>age</code> and <code>hgt</code>. In this case, high outcome-specific utility implies that the regression coefficients obtained from the synthetic data are close to the coefficients estimated from the observed data. One way to measure â€œclosenessâ€ in this context is via the confidence interval overlap. The confidence interval overlap quantifies to what extent the confidence intervals of the observed and synthetic coefficients overlap: <span class="math display">\[
CIO = \frac{1}{2} \Big(
    \frac{\min (U_\text{obs}, U_\text{syn}) -
    \max (L_\text{obs}, L_\text{syn})}{
        U_\text{obs} - L_\text{syn}
    } + \frac{\min (U_\text{obs}, U_\text{syn}) -
    \max (L_\text{obs}, L_\text{syn})}{
        U_\text{syn} - L_\text{obs}
    }  \Big).
\]</span> The terms <span class="math inline">\(U\)</span> and <span class="math inline">\(L\)</span> denote the upper and lower bounds of the <span class="math inline">\(95\%\)</span> confidence intervals for the observed and synthetic data. Visually, the <span class="math inline">\(CIO\)</span> can be depicted as follows:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/CIO-fig-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The length between the dashed vertical lines is the quantity in the numerator, whereas the lengths of the two horizontal lines are in the denominators. If the two confidence intervals are almost the same, the confidence interval overlap is large, and the difference between coefficients is relatively small compared to the uncertainty around the coefficients. Conversely, if the overlap is small (or even negative), the coefficients are relatively far apart, relative to the random variation one would expect.</p>
<hr>
<p><strong>11. Fit a linear regression model with the above specification using <code>lm.synds()</code> for both synthetic data sets. Compare the results with the observed data using <code>compare.fit.synds()</code>.</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Regression models</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fit_passive <span class="ot">&lt;-</span> <span class="fu">lm.synds</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    hc <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> hgt <span class="sc">+</span> <span class="fu">I</span>(hgt<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> wgt <span class="sc">+</span> reg, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> syn_passive</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>fit_cart <span class="ot">&lt;-</span> <span class="fu">lm.synds</span>(</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    hc <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> hgt <span class="sc">+</span> <span class="fu">I</span>(hgt<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> wgt <span class="sc">+</span> reg, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> syn_cart</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">compare.fit.synds</span>(fit_passive, <span class="at">data =</span> data)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">compare.fit.synds</span>(fit_cart, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
â„¹ Please use tidy evaluation idioms with `aes()`.
â„¹ See also `vignette("ggplot2-in-packages")` for more information.
â„¹ The deprecated feature was likely used in the synthpop package.
  Please report the issue to the authors.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call used to fit models to the data:
lm.synds(formula = hc ~ age + I(age^2) + hgt + I(hgt^2) + wgt + 
    reg, data = syn_passive)

Differences between results based on synthetic and observed data:
                Synthetic     Observed         Diff Std. coef diff CI overlap
(Intercept) 33.3374137880  7.583220128 25.754193660     23.6277044 -5.0275864
age         -0.1867533282 -1.929989279  1.743235951     14.9660859 -2.8179492
I(age^2)     0.0006288912  0.063148825 -0.062519934    -15.4874290 -2.9509474
hgt          0.1562515139  0.663979162 -0.507727648    -25.2331041 -5.4371346
I(hgt^2)    -0.0005057012 -0.001868775  0.001363074     19.5251952 -3.9810087
wgt          0.2206018121  0.068799183  0.151802629     14.9315498 -2.8091388
regeast      0.6147377070 -0.008439947  0.623177654      2.7604156  0.2957994
regwest     -0.3490120497 -0.074055195 -0.274956854     -1.2924879  0.6702776
regsouth     0.0327038384 -0.034981195  0.067685034      0.3076278  0.9215221
regcity      2.5014409312  0.171141483  2.330299449      8.7308986 -1.2273110

Measures for one synthesis and 10 coefficients
Mean confidence interval overlap:  -2.236348
Mean absolute std. coef diff:  12.68625

Mahalanobis distance ratio for lack-of-fit (target 1.0): 150.27
Lack-of-fit test: 1502.707; p-value 0 for test that synthesis model is
compatible with a chi-squared test with 10 degrees of freedom.

Confidence interval plot:</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/fit-models-output-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call used to fit models to the data:
lm.synds(formula = hc ~ age + I(age^2) + hgt + I(hgt^2) + wgt + 
    reg, data = syn_cart)

Differences between results based on synthetic and observed data:
               Synthetic     Observed          Diff Std. coef diff CI overlap
(Intercept)  8.199799771  7.583220128  0.6165796428     0.56566949  0.8556939
age         -1.975133292 -1.929989279 -0.0451440124    -0.38757184  0.9011278
I(age^2)     0.063332400  0.063148825  0.0001835746     0.04547507  0.9883990
hgt          0.647387051  0.663979162 -0.0165921101    -0.82459650  0.7896399
I(hgt^2)    -0.001733560 -0.001868775  0.0001352159     1.93688353  0.5058880
wgt          0.051062964  0.068799183 -0.0177362187    -1.74456288  0.5549503
regeast      0.004708119 -0.008439947  0.0131480658     0.05824042  0.9851425
regwest     -0.104533244 -0.074055195 -0.0304780487    -0.14326797  0.9634514
regsouth    -0.048260585 -0.034981195 -0.0132793900    -0.06035470  0.9846031
regcity      0.006345831  0.171141483 -0.1647956513    -0.61743744  0.8424876

Measures for one synthesis and 10 coefficients
Mean confidence interval overlap:  0.8371383
Mean absolute std. coef diff:  0.638406

Mahalanobis distance ratio for lack-of-fit (target 1.0): 0.82
Lack-of-fit test: 8.212925; p-value 0.608 for test that synthesis model is
compatible with a chi-squared test with 10 degrees of freedom.

Confidence interval plot:</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/fit-models-output-2.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The results show that the <code>syn_cart</code> data yields substantially higher outcome-specific utility, as the estimated regression coefficients are substantially closer to the estimates from the observed data than the <code>syn_passive</code> estimates. Moreover, the confidence intervals of the observed data overlap substantially with the confidence intervals of <code>syn_cart</code>, suggesting that the differences between the estimates are relatively small compared to the uncertainty around the regression coefficients.</p>
</div>
</div>
</div>
<p>One tip for evaluating outcome-specific utility is that if you expect data users are solely interested in analyses in the class of general linear models (like <span class="math inline">\(t\)</span>-tests, ANOVAs and linear regression models) with merely main effects, modelling the variance-covariance matrix and the means of the observed sufficiently accurate is sufficient. From these characteristics, all regression coefficients or mean differences can be calculated.</p>
<hr>
</section>
<section id="statistical-disclosure-control" class="level1">
<h1>Statistical disclosure control</h1>
<hr>
<p>Synthetic data can provide a relatively safe framework for sharing data. However, some risks will remain present, and it is important to evaluate these risks. For example, it can be the case that the synthesis models were so complex that the synthetic records are very similar or even identical to the original records, which can lead to privacy breaches.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Privacy of synthetic data">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Privacy of synthetic data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Synthetic data by itself does not provide any formal privacy guarantees. These guarantees can be incorporated, for example by using differentially private synthesis methods. However, these methods are not yet widely available in R. If privacy is not built-in by design, it remains important to inspect the synthetic data for potential risks. Especially if youâ€™re not entirely sure, it is better to stay at the safe side: use relatively simple, parametric models, check for outliers, and potentially add additional noise to the synthetic data. See also Chapter 4 in the book Synthetic Data for Official Statistics.</p>
</div>
</div>
<p>We focus the evaluation of disclosure again on identity disclosure and attribute disclosure, as discussed in the <a href="../sdc/">Statistical Disclosure Control section</a>. In short, identity disclosure implies that it is possible to identify records in the synthetic data from a set of known characteristics. Identity disclosure is not typically possible if the entire dataset is comprised of solely synthetic values, but it is still an important aspect of attribute disclosure. Attribute disclosure occurs when it is possible to infer new information from a set of known characteristics. For example, if all individuals above a certain age in some region have a given disease, one might conclude that someone satisfying these constraints also has that disease.</p>
<p>We evaluate identity disclosure using the <em>replicated uniques</em> measure, which refers to unique observations in the synthetic data that were also unique cases in the observed data <span class="citation" data-cites="raab_disclosure_2024">(on a set of identifying variables; <a href="#ref-raab_disclosure_2024" role="doc-biblioref">Raab 2024</a>)</span>. These identifying variables must be specified by synthetic data modeller. The idea is that observations that have a unique set of identifying variables can be identified by a third party. If these identifying variables re-occur in the synthetic data, and correspond to an actual observation, a third party might conclude that a particular individual is sampled. At the same time, if the synthetic values on at least one of the non-identifying, but potentially sensitive, variables are also the same or very close to the actual values, this might allow for attribute disclosure. These replicated uniques can be removed from the synthetic data, which might not reduce the utility of the synthetic data too much.</p>
<p>Attribute disclosure is measured using a prediction model, and essentially asks the question whether we can correctly predict some target variable from a set of identifying variables. If this is possible in general, knowing someoneâ€™s values on a set of identifying variables allows to infer potentially sensitive information on the target variable. In <code>synthpop</code>, this procedure is implemented as follows <span class="citation" data-cites="raab_disclosure_2024">(<a href="#ref-raab_disclosure_2024" role="doc-biblioref">Raab 2024</a>)</span>. First, we check which combinations of the identifying variables in the observed data also occur in the synthetic data. Subsequently, we evaluate whether the records with the same values on the identifying variables in the synthetic data also have the same values (or very similar values) on the target variable. Finally, we check whether this value corresponds to the actual value on the target variable in the original data. The proportion of records that meets each of these criteria is referred to as <em>DiSCO</em> (Disclosive in Synthetic, Correct in Original).</p>
<p>Both methods (<em>replicated uniques</em> and <em>DiSCO</em>) can be evaluated in <code>synthpop</code> using the <code>multi.disclosure()</code> function.</p>
<hr>
<p><strong>12. Call the function <code>multi.disclosure()</code> on the <code>syn_passive</code> and <code>syn_cart</code> data sets. Use <code>age</code>, <code>hgt</code> and <code>reg</code> as identifying variables (the <code>keys</code> argument).</strong></p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Statistical disclosure control</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multi.disclosure</span>(syn_passive, data, <span class="at">keys =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"reg"</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multi.disclosure</span>(syn_cart, data, <span class="at">keys =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"reg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Show output">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>------------------ 1 wgt ------------------- 
-------------------Synthesis 1 --------------------
Table for target wgt from GT alone with keys has 523 rows 748 colums.
Table for target  wgt from GT &amp; SD with all key combinations has 523 rows 1493 colums.
------------------ 2 bmi ------------------- 
-------------------Synthesis 1 --------------------
Table for target bmi from GT alone with keys has 524 rows 748 colums.
Table for target  bmi from GT &amp; SD with all key combinations has 1260 rows 1493 colums.
------------------ 3 hc ------------------- 
-------------------Synthesis 1 --------------------
Table for target hc from GT alone with keys has 204 rows 748 colums.
Table for target  hc from GT &amp; SD with all key combinations has 204 rows 1493 colums.
------------------ 4 gen ------------------- 
-------------------Synthesis 1 --------------------
Table for target gen from GT alone with keys has 5 rows 748 colums.
Table for target  gen from GT &amp; SD with all key combinations has 5 rows 1493 colums.
------------------ 5 phb ------------------- 
-------------------Synthesis 1 --------------------
Table for target phb from GT alone with keys has 6 rows 748 colums.
Table for target  phb from GT &amp; SD with all key combinations has 6 rows 1493 colums.
------------------ 6 tv ------------------- 
-------------------Synthesis 1 --------------------
Table for target tv from GT alone with keys has 18 rows 748 colums.
Table for target  tv from GT &amp; SD with all key combinations has 18 rows 1493 colums.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Disclosure risk for 748 records in the original data

Identity disclosure measures
from keys: age hgt reg 
For original  ( UiO )  100 %
For synthetic ( repU ) 0.4 %.

Table of attribute disclosure measures for age hgt reg 
Original measure is  Dorig and synthetic measure is DiSCO 
Variables Ordered by synthetic disclosure measure

      attrib.orig attrib.syn check1 Npairs check2
1 wgt         100       0.00             0       
2 bmi         100       0.00             0       
3 hc          100       0.00             0       
4 gen         100       0.13             0       
5 phb         100       0.13             0       
6 tv          100       0.13             0       </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/sdc-output-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------ 1 wgt ------------------- 
-------------------Synthesis 1 --------------------
Table for target wgt from GT alone with keys has 523 rows 748 colums.
Table for target  wgt from GT &amp; SD with all key combinations has 1271 rows 1496 colums.
------------------ 2 bmi ------------------- 
-------------------Synthesis 1 --------------------
Table for target bmi from GT alone with keys has 524 rows 748 colums.
Table for target  bmi from GT &amp; SD with all key combinations has 1272 rows 1496 colums.
------------------ 3 hc ------------------- 
-------------------Synthesis 1 --------------------
Table for target hc from GT alone with keys has 204 rows 748 colums.
Table for target  hc from GT &amp; SD with all key combinations has 952 rows 1496 colums.
------------------ 4 gen ------------------- 
-------------------Synthesis 1 --------------------
Table for target gen from GT alone with keys has 5 rows 748 colums.
Table for target  gen from GT &amp; SD with all key combinations has 5 rows 1496 colums.
------------------ 5 phb ------------------- 
-------------------Synthesis 1 --------------------
Table for target phb from GT alone with keys has 6 rows 748 colums.
Table for target  phb from GT &amp; SD with all key combinations has 6 rows 1496 colums.
------------------ 6 tv ------------------- 
-------------------Synthesis 1 --------------------
Table for target tv from GT alone with keys has 18 rows 748 colums.
Table for target  tv from GT &amp; SD with all key combinations has 25 rows 1496 colums.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Disclosure risk for 748 records in the original data

Identity disclosure measures
from keys: age hgt reg 
For original  ( UiO )  100 %
For synthetic ( repU ) 0 %.

Table of attribute disclosure measures for age hgt reg 
Original measure is  Dorig and synthetic measure is DiSCO 
Variables Ordered by synthetic disclosure measure

      attrib.orig attrib.syn check1 Npairs check2
1 wgt         100          0             0       
2 bmi         100          0             0       
3 hc          100          0             0       
4 gen         100          0             0       
5 phb         100          0             0       
6 tv          100          0             0       </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/sdc-output-2.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>From the output, it can be seen that disclosure risk is very low for both synthesis methods, according to the criteria defined here. For the <code>syn_passive</code> data, there are 3 replicated uniques, and for the <code>syn_cart</code> data, there are none. The figures show that the attribute disclosure measures are equal to zero in the synthetic data.</p>
</div>
</div>
</div>
<p>After evaluating disclosure risks, it is possible to perform post-processing of the synthetic data. This procedure can be streamlined using the <code>sdc()</code> function in <code>synthpop</code>. For example, one might remove the <em>replicated uniques</em> from the synthetic data, using the <code>rm.replicated.uniques</code> argument in <code>sdc()</code>. Additionally, it is possible to cap outliers using the <code>bottom.top.coding</code> argument or to smooth variables using <code>smooth.vars</code>.</p>
<p>In our case, we already applied smoothing, and there are not really any extreme outliers present. Therefore, we only remove the replicated uniques from the data.</p>
<hr>
<p><strong>13. Apply the <code>sdc()</code> function with <code>keys = c("age", "hgt", "reg")</code> and set <code>rm.replicated.uniques = TRUE</code> and store the results in <code>syn_passive_sdc</code>.</strong></p>
<p><em>Hint:</em> This function updates the synthetic data object, make sure to release the synthetic data from the updated object if you use this function.</p>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show code: Apply statistical disclosure control methods</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>syn_passive_sdc <span class="ot">&lt;-</span> <span class="fu">sdc</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    syn_passive, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">keys =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"reg"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rm.replicated.uniques =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<hr>
<p>In these practicals, you have learned to create and evaluate synthetic data. We discussed modelling deterministic relationships, refining synthesis models based on utility measures, comparing utility of synthetic data sets, and evaluating remaining disclosure risks. Remember that if you plan to release synthetic data for open science purposes, it is better to stay on the safe side with respect to privacy. When in doubt, choose the option that yields the smallest risk. Also, make clear that the synthetic data is not real data, and that new analyses should thus be conducted with caution. Unless the synthesis model is correctly specified, new analyses are likely to give biased results, and results should thus not be overinterpreted.</p>



</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-drechsler_30years_2024" class="csl-entry" role="listitem">
Drechsler, JÃ¶rg, and Anna-Carolina Haensch. 2024. <span>â€œ30 Years of Synthetic Data.â€</span> <em>Statistical Science</em> 39 (2): 221â€“42. <a href="https://doi.org/10.1214/24-STS927">https://doi.org/10.1214/24-STS927</a>.
</div>
<div id="ref-islr" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An Introduction to Statistical Learning</em>. 2nd ed. Springer Texts in Statistics. New York: Springer. <a href="https://doi.org/10.1007/978-1-0716-1418-1">https://doi.org/10.1007/978-1-0716-1418-1</a>.
</div>
<div id="ref-raab_disclosure_2024" class="csl-entry" role="listitem">
Raab, Gillian M. 2024. <span>â€œPrivacy Risk from&nbsp;Synthetic Data: Practical Proposals.â€</span> In <em>Privacy in Statistical Databases</em>, edited by Josep Domingo-Ferrer and Melek Ã–nen, 254â€“73. Cham: Springer Nature Switzerland. <a href="https://doi.org/10.1007/978-3-031-69651-0_17">https://doi.org/10.1007/978-3-031-69651-0_17</a>.
</div>
<div id="ref-snoke_utility_2018" class="csl-entry" role="listitem">
Snoke, Joshua, Gillian M. Raab, Beata Nowok, Chris Dibben, and Aleksandra Slavkovic. 2018. <span>â€œGeneral and Specific Utility Measures for Synthetic Data.â€</span> <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em> 181 (3): 663â€“88. <a href="https://doi.org/10.1111/rssa.12358">https://doi.org/10.1111/rssa.12358</a>.
</div>
<div id="ref-densityratio" class="csl-entry" role="listitem">
Volker, Thom Benjamin, Carlos Gonzalez Poses, and Erik-Jan van Kesteren. 2024. <span>â€œDensityratio: Distribution Comparison Through Density Ratio Estimation.â€</span> <a href="https://doi.org/10.5281/zenodo.13881689">https://doi.org/10.5281/zenodo.13881689</a>.
</div>
<div id="ref-volker_density_2024" class="csl-entry" role="listitem">
Volker, Thom Benjamin, Peter-Paul de Wolf, and Erik-Jan van Kesteren. 2024. <span>â€œA Density Ratio Framework for Evaluating the Utility of Synthetic Data.â€</span> <a href="https://arxiv.org/abs/2408.13167">https://arxiv.org/abs/2408.13167</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/thomvolker\.github\.io\/synthetic-data-tutorial\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright, 2025 Open Science Center at LMU Munich</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/lmu-osc/synthetic-data-tutorial/edit/main/evaluation/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/lmu-osc/synthetic-data-tutorial/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>